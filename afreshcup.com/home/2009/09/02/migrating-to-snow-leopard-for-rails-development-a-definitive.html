<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Migrating to Snow Leopard for Rails Development - A Definitive Guide</title>
  <meta name="description" content="I spent a good chunk of the last couple of days upgrading one of my Macs to Snow Leopard (OS X 10.6), and keeping notes as I went. I had several goals here: ...">

  <link rel="stylesheet" href="../../../../assets/main.css">
  <link rel="canonical" href="migrating-to-snow-leopard-for-rails-development-a-definitive.html">
  <link rel="alternate" type="application/rss+xml" title="RSS" href="../../../../atom.xml">
  <link rel="alternate" type="application/atom+xml" title="ATOM" href="../../../../atom.xml" />
  <link rel="alternate" title="JSON" type="application/json" href="../../../../json_feed.json" />

  <link rel="apple-touch-icon" sizes="180x180" href="../../../../images/favicon/apple-touch-icon.png%3Fv=9ByKGgW0ed">
  <link rel="icon" type="image/png" sizes="32x32" href="../../../../images/favicon/favicon-32x32.png%3Fv=9ByKGgW0ed">
  <link rel="icon" type="image/png" sizes="16x16" href="../../../../images/favicon/favicon-16x16.png%3Fv=9ByKGgW0ed">
  <link rel="manifest" href="../../../../images/favicon/manifest.json%3Fv=9ByKGgW0ed">
  <link rel="mask-icon" href="../../../../images/favicon/safari-pinned-tab.svg%3Fv=9ByKGgW0ed" color="#5bbad5">
  <link rel="shortcut icon" href="../../../../images/favicon/favicon.ico%3Fv=9ByKGgW0ed">
  <meta name="msapplication-config" content="/images/favicon/browserconfig.xml?v=9ByKGgW0ed">
  <meta name="theme-color" content="#ffffff">
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="../../../../index.html">A Fresh Cup</a>

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="https://topics.afreshcup.com">Topics</a>
            <a class="page-link" href="../../../../about.html">About</a>
            <a class="page-link" href="../../../../uses.html">Uses</a>
        </div>

      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Migrating to Snow Leopard for Rails Development - A Definitive Guide</h1>
    <p class="post-meta">
      <time datetime="2009-09-02T00:00:00-05:00" itemprop="datePublished">
        
        Sep 2, 2009
      </time>
      </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    I spent a good chunk of the last couple of days upgrading one of my Macs to Snow Leopard (OS X 10.6), and keeping notes as I went. I had several goals here:<br><br><ul>
<li>Develop a repeatable process I could use on my main development box</li>
<br><li>Set up multiple versions of Ruby, as I expect 1.9 compatibility to be increasingly important</li>
<br><li>Avoid MacPorts, as it's been problematic for me and I don't like two copies of everything</li>
<br><li>Prevent disasters</li>
<br><li>Migrate applications and documents from the previous setup on the same box</li>
<br>
</ul>
<br><br>I'm pretty happy with where it all ended up, but please realize that this guide is only definitive for me: just because this is the way it worked for me does not mean it's the only way to set things up for Rails development. I hope some folks find this helpful, but the main reason I wanted to work all this out was to handle our own in-house Macs.<br><br>1. Install external hard drive. <a href="http://www.amazon.com/LaCie-FireWire-External-301442U-Aluminum/dp/B001KFH6K6">I used a LaCie d2 Quadra</a>. At $150 with free shipping (we happily pay for Amazon Prime) it's cheap insurance. Didn’t bother with their Setup Assistant (who the heck still writes software that requires Rosetta?), just erased it with Disk Utility and formatted it as one big journaled OS X volume.<br><br>2. Install <strong><a href="http://www.shirt-pocket.com/SuperDuper/SuperDuperDescription.html">SuperDuper</a></strong> (http://www.shirt-pocket.com/SuperDuper/SuperDuperDescription.html). I’m sure <a href="http://www.bombich.com/software/ccc.html">Carbon Copy Cloner</a> is just as good, I just happen to be a SuperDuper user. Even if you're not a paying customer, SuperDuper is free to use in interactive mode, which is all this procedure requires.<br><br>3. Log out and log back in with the shift key held down to prevent startup items from running.<br><br>4. Launch SuperDuper and back up the internal hard drive to the external hard drive with the "Backup - All Files" script.<br><br>5. Restart, holding down the Option key when the box restarts. This will let you choose to restart from the backup you just made. Booting from the external drive will take a lot longer than from the internal one, but don't skip this step. You'll feel pretty darned stupid if you bootable backup isn't. Hold down shift after selecting the drive to bypass startup items so you don't clutter the backup.<br><br>6. While you're in there, launch terminal and :<br><br><pre><code><br>gem list &gt; gemlist.txt<br>port list installed &gt; portlist.txt<br></code></pre>
<br><br>I didn't use the port list for anything myself, but it was a good reference for things I needed to install otherwise.<br><br>7. Now it's time to do some cleaning up of your backup to prepare for the later migration. Mac's Migration Assistant doesn't offer a lot of granularity, so you need to get rid of anything from your Applications, Documents, and other descendants of your home directory that you don't want to move. The more you delete now, the faster the migration will go, so delete any applications and documents that you don't want on the rebuilt Mac. Good time to clean up the Dock as well. I blew away my local gems as well at this point.<br><br>I also recommend completely blowing away /usr/local and /opt/local to make sure you’re doing a “clean everything” install even after migrating. Edit your .bash_login to remove them from the path as well (optionally, you may want to rename these directories to have them available for reference).<br><br>8. If you're a PostgreSQL user, make a backup of your databases. Tyler Hunt has <a href="http://devoh.com/posts/2009/08/postgresql-snow-leopard">clear instructions</a> for this.<br><br>9. Put in the Snow Leopard DVD. Ignore the Finder window when it pops up.<br><br>10. Power down the computer.<br><br>11. Unplug the backup drive. No sense taking chances.<br><br>12. Restart with the option key held down again. Choose the Mac OS X Install DVD to boot from.<br><br>13. The "Erase and Install" option is gone from the Snow Leopard installer, so when you get to the "Install Mac OS X" screen select Disk Utility from the Utilities menu instead.<br><br>14. Select the "Macintosh HD" partition on your hard drive. Select the Erase tab. Select the "Mac OS Extended (Journaled)" format. Click Erase. Grit your teeth and confirm.<br><br>15. When OS X is done reformatting the partition, close Disk Utility, click Continue on the OS X installer, and work your way through the rest of the prompts.<br><br>16. When you get to the "Do You Already Own a Mac?" screen (this is after the installation restart, so don't panic when the machine restarts), plug the external drive back in. Select "From another volume on this Mac" and click Continue.<br><br>17. The top of the "Transfer Your Information" screen should show that you're transferring from the external drive. Leave all the options checked and click Transfer.<br><br>18. Log into happy new OS X. Bask in it for a little bit. Wait a minute for Software Update to kick in, or run it manually and install whatever it comes up with. If it doesn't find anything, that's great.<br><br>19. While you've got the Snow Leopard DVD in the drive, pop option the Optional Installs folder and install XCode.<br><br>20. I personally prefer wget to curl (just habit, I suppose) which means that I have to install it:<br><br><a href="http://www.gnu.org/software/wget/">GNU wget home page</a><br><br>[sourcecode language='bash']<br>Download wget-latest.tar.gz from http://ftp.gnu.org/gnu/wget/<br>tar -xzvf wget-latest.tar.gz<br>cd wget-1.11.4/<br>./configure<br>make<br>sudo make install<br>[/sourcecode]<br><br>21. I'm trying a no-MacPorts approach this time around. This means installing a current readline by hand, since multiple pieces of software still reportedly have issues with Apple's default version:<br><br><a href="http://tiswww.case.edu/php/chet/readline/rltop.html">GNU Readline home page</a><br><br>[sourcecode language='bash']<br>wget ftp://ftp.cwru.edu/pub/bash/readline-6.0.tar.gz<br>tar -xvzf readline-6.0.tar.gz<br>cd readline-6.0<br>./configure<br>make<br>sudo make install<br>[/sourcecode]<br><br>22. This is a good point to make sure your .bash_login and .bash_profile are the way you want them. For me, that’s an empty .bash_login and a pretty minimal .bash_profile. Here’s my .bash_profile, though you probably want to tune your own:<br><br><pre><code><br>export PATH=/usr/local/git/bin:/usr/local/bin/src:/usr/local/bin:<br>  /usr/local/sbin:/usr/local/mysql/bin:~/bin:$PATH<br><br>export EDITOR='mate -w'<br>export PAGER=most<br><br>function parse_git_dirty {<br>  [[ $(git status 2&gt; /dev/null | tail -n1) != <br>    "nothing to commit (working directory clean)" ]] &amp;&amp; echo "*"<br>}<br>function parse_git_branch {<br>  git branch --no-color 2&gt; /dev/null | <br>    sed -e '/^[^*]/d' -e "s/* \(.*\)/[\1$(parse_git_dirty)]/"<br>}<br><br>export PS1='\[33[1;36m\]\h\[33[0;33m\] \w \[33[31;40m\]<br>  $(parse_git_branch)\[33[00m\] $ '<br><br>export HISTCONTROL=erasedups<br>export HISTSIZE=10000<br>shopt -s histappend<br><br>EVENT_NOKQUEUE=yes<br></code></pre>
<br><br>23. Snow Leopard includes a recent version of SQLite, but you know, as long as we're building things we may as well make it current. <br><br><a href="http://www.sqlite.org/download.html">SQLite Download Page</a><br><br><a href="http://www.sqlite.org/cvstrac/wiki?p=HowToCompile">SQLite Build Instructions</a><br><br>[sourcecode language='bash']<br>wget http://www.sqlite.org/sqlite-amalgamation-3.6.17.tar.gz<br>tar -xvzf sqlite-amalgamation-3.6.17.tar.gz<br>cd sqlite-3.6.17/<br>./configure<br>make<br>sudo make install[/sourcecode]<br><br>24. Now for MySQL. If you have a previous version of MySQL installed, you probably have the old MySQL preference pane, which doesn't work under Snow Leopard. Fortunately swoon.net has recompiled a <a href="http://www.swoon.net/site/software.html">64-bit version</a>. Grab it and install it. Then pop into System Preferences and stop your MySQL server if it's running.<br><br>25.  Given that there are prebuilt x64 binaries for OS X, I don't feel any particular need to build MySQL from scratch. I've found anything past MySQL 5.1 to be problematic for Rails.<br><br><a href="http://dev.mysql.com/downloads/mysql/5.1.html#macosx-dmg">MySQL Download Page</a><br><br>Pick a mirror and download the "Mac OS X 10.5 (x86_64)" version. Mount the dmg and run the MySQL package and then the MySQL startup item package. Then start MySQL:<br><br>[sourcecode language='bash']<br>sudo /Library/StartupItems/MySQLCOM/MySQLCOM start<br>[/sourcecode]<br><br>26. If you have existing MySQL databases to bring over from an old version, see the <a href="http://gist.github.com/177368">instructions from edward</a> - remember to change the old directory name to match the version you were running before.<br><br>27. SQLite and MySQL are nice, but these days I’m using PostgreSQL for new Rails work. If you want a shortcut, there’s an <a href="http://www.enterprisedb.com/products/pgdownload.do#osx">installer that runs on OS X</a>: grab it and run it. But to get best performance, you probably should build by hand. There are <a href="http://devoh.com/posts/2008/10/installing-postgresql-on-mac-os-x-10.5-leopard">good instructions</a> from Tyler Hunt for that, though you need to update the download version. Don’t install the postgres gem though; it’s slow and outdated, and anyhow there’s still work to do to get gems set up.<br><br><a href="http://www.postgresql.org/ftp/source/">PostgreSQL source code</a><br><br>[sourcecode language='bash']<br>wget ftp://ftp.postgresql.org/pub/source/v8.4.0/postgresql-8.4.0.tar.gz<br>tar -xvzf postgresql-8.4.0.tar.gz<br>cd postgresql-8.4.0<br>./configure --enable-thread-safety --with-bonjour<br>[/sourcecode]<br><br>And follow Tyler's instructions from there for installing, creating a group and user, and hooking up launchd.<br><br>28. <a href="http://devoh.com/posts/2009/08/postgresql-snow-leopard">Reload your old PostgreSQL databases</a>.<br><br>29. Databases in hand, let’s turn to ruby. Given that I expect a transition to ruby 1.9 over the next year, and I find myself wanting to test on odd rubies from time to time, I’m going to completely ignore the system ruby except to bootstrap a multiruby setup. Fortunately, the recently-released Ruby Version Manager is working great already.<br><br><a href="http://rvm.beginrescueend.com/">Ruby Version Manager homepage</a><br><br>[sourcecode language='bash']<br>sudo gem install rvm<br>rvm-install<br>rvm install 1.8.6 -C --enable-shared,--with-readline-dir=/usr/local<br>rvm install 1.8.7 -C --enable-shared,--with-readline-dir=/usr/local<br>rvm install 1.9.1 -C --enable-shared,--with-readline-dir=/usr/local<br>rvm install 1.9.2 -C --enable-shared,--with-readline-dir=/usr/local<br>rvm 1.8.7 --default<br>[/sourcecode]<br><br>I'm skipping REE, JRuby, and Rubinius for the moment, but will likely add them to the system later.<br><br>30. Time to install the two problematic gems. I’m just going to do this under 1.8.7 for now, but will update the other rubies later.<br><br><strong>MySQL</strong>: (from <a href="http://www.gregbenedict.com/2009/08/29/fixing-ruby-gems-mysql-and-passenger-phusion-on-snow-leopard-10-6/">Greg Benedict</a>)<br><br>[sourcecode language='bash']<br>sudo env ARCHFLAGS="-arch x86_64" gem install mysql -- --with-mysql-config=/usr/local/mysql/bin/mysql_config<br>[/sourcecode]<br><br><strong>PostgreSQL</strong>: (from <a href="http://www.icoretech.org/2009/08/how-to-install-pg-postgresql-gem-on-snow-leopard-64-bit/">iCoreTech</a>)<br><br>[sourcecode language='ruby']<br>sudo -s<br>export ARCHFLAGS='-arch x86_64'<br>export PATH=/usr/local/pgsql/bin:${PATH}<br>gem install pg<br>exit<br>[/sourcecode]<br><br>31. The rest of the gems should be easier. Grab the gemlist.txt file you created way back at the start and edit it to one gem name per line. Ditch anything you know you don’t need. Then fire up IRB and run:<br><br>[sourcecode language='ruby']<br>File.open('/Users/mike/gemlist.txt').each_line {|line| `sudo gem install #{line.split.first}`}<br>[/sourcecode]<br><br>Obviously change the file name to match where you put it on your own drive.<br><br><em>This could use some tweaking to deliver feedback.</em><br><br>[stalled at RedCloth?]<br><br>32. This is a good time to get git on the system. Fortunately, there’s an easy and functional <a href="http://code.google.com/p/git-osx-installer/">OS X installer</a> for that. Download, mount the disk image, and run the installer and shell script.<br><br>33. imagemagick used to be a bear, but at the moment there’s a good install script for it on GitHub. So, now that you have your shiny new copy of git:<br><br>[sourcecode language='bash']<br>git clone git://github.com/maddox/magick-installer.git<br>cd magick-installer/<br>./magick-installer.sh<br>[/sourcecode]<br><br>34. I also need memcached locally. Wincent has <a href="https://wincent.com/wiki/Installing_memcached_1.4.1_on_Mac_OS_X_10.6_Snow_Leopard">good install instructions</a>:<br><br>[sourcecode language='bash']<br>wget http://www.monkey.org/~provos/libevent-1.4.12-stable.tar.gz<br>tar xvzf libevent-1.4.12-stable.tar.gz<br>cd libevent-1.4.12-stable<br>./configure<br>make<br>sudo make install<br>wget http://memcached.googlecode.com/files/memcached-1.4.1.tar.gz<br>tar xvzf memcached-1.4.1.tar.gz<br>cd memcached-1.4.1<br>./configure<br>make<br>sudo make install<br>[/sourcecode]<br><br>35. I’d like to run <a href="http://luigimontanez.com/2008/running-a-local-gem-documentation-server-on-mac-os-x-2">gem server locally on a startup basis</a> to handle my gem RDoc needs, but I need to figure out how (or whether) that can be made to play nicely with rvm. Meanwhile, <a href="http://github.com/manalang/bdoc/tree/master">bdoc</a> is an acceptable alternative:<br><br>[sourcecode language='bash']<br>sudo gem install manalang-bdoc<br>[/sourcecode]<br><br>36. Finally (for now!) I prefer most as a pager to less or more. It supports paging forwards and backwards, split windows, and can even drop the file you're paging right into your editor of choice.<br><br><a href="http://www.jedsoft.org/most/">Most home page</a><br><br>You’ll need some prerequisites first:<br><br><strong>pcre</strong>:<br><br>[sourcecode language='bash']<br>wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-7.9.tar.gz<br>tar xvzf pcre-7.9.tar.gz<br>cd pcre-7.9<br>./configure<br>make<br>sudo make install<br>[/sourcecode]<br><br><strong>Oniguruma</strong>:<br><br>[sourcecode language='bash']<br>wget http://www.geocities.jp/kosako3/oniguruma/archive/onig-5.9.1.tar.gz<br>tar xvzf onig-5.9.1.tar.gz<br>cd onig-5.9.1<br>./configure<br>make<br>sudo make install<br>[/sourcecode]<br><br><strong>S-Lang</strong>:<br><br>[sourcecode language='bash']<br>wget ftp://space.mit.edu/pub/davis/slang/v2.2/slang-2.2.0.tar.gz<br>tar xvzf slang-2.2.0.tar.gz<br>cd slang-2.2.0<br>./configure<br>make<br>sudo make install<br>[/sourcecode]<br><br>And now <strong>most</strong> at last:<br><br>[sourcecode language='bash']<br>wget ftp://space.mit.edu/pub/davis/most/most-5.0.0.tar.gz<br>tar xvzf most-5.0.0.tar.gz<br>cd most-5.0.0<br>./configure<br>make<br>sudo make install<br>[/sourcecode]<br><br>And there you have it! Start to finish, this process took me about 3 hours on a MacBook Pro with around 90GB of data that I wanted to save. I expect it to take much longer on the desktop with the correspondingly larger hard drive, but much of that will be overnight backup and restore times. If you have any tweaks and suggestions, feel free to add them to the comments.

  </div>

  
    

  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://afreshcup.com/home/2009/09/02/migrating-to-snow-leopard-for-rails-development-a-definitive.html';
      this.page.identifier = 'https://afreshcup.com/home/2009/09/02/migrating-to-snow-leopard-for-rails-development-a-definitive.html';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://a-fresh-cup.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">A Fresh Cup</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              none
            
            </li>
            
            <li><a href="mailto:blank@example.com">blank@example.com</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/nil"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">nil</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/nil"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">nil</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Out of business.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
